#!/usr/bin/env python3
"""
===========================================================================================================================================================
 /$$      /$$           /$$                /$$$$$$                                          /$$   /$$                       /$$                 /$$      
| $$  /$ | $$          | $$               /$$__  $$                                        |__/  | $$                      | $$                | $$      
| $$ /$$$| $$  /$$$$$$ | $$$$$$$         | $$  \__/  /$$$$$$   /$$$$$$$ /$$   /$$  /$$$$$$  /$$ /$$$$$$   /$$   /$$        | $$        /$$$$$$ | $$$$$$$ 
| $$/$$ $$ $$ /$$__  $$| $$__  $$ /$$$$$$|  $$$$$$  /$$__  $$ /$$_____/| $$  | $$ /$$__  $$| $$|_  $$_/  | $$  | $$ /$$$$$$| $$       |____  $$| $$__  $$
| $$$$_  $$$$| $$$$$$$$| $$  \ $$|______/ \____  $$| $$$$$$$$| $$      | $$  | $$| $$  \__/| $$  | $$    | $$  | $$|______/| $$        /$$$$$$$| $$  \ $$
| $$$/ \  $$$| $$_____/| $$  | $$         /$$  \ $$| $$_____/| $$      | $$  | $$| $$      | $$  | $$ /$$| $$  | $$        | $$       /$$__  $$| $$  | $$
| $$/   \  $$|  $$$$$$$| $$$$$$$/        |  $$$$$$/|  $$$$$$$|  $$$$$$$|  $$$$$$/| $$      | $$  |  $$$$/|  $$$$$$$        | $$$$$$$$|  $$$$$$$| $$$$$$$/
|__/     \__/ \_______/|_______/          \______/  \_______/ \_______/ \______/ |__/      |__/   \___/   \____  $$        |________/ \_______/|_______/ 
                                                                                                          /$$  | $$                                      
                                                                                                         |  $$$$$$/                                      
                                                                                                          \______/                                       
===========================================================================================================================================================
===========================================================================================================================================================
 Script     : zap_api_scan.py
 Auteur     : Lysius
 Date       : 14/12/2024
 Description: Script Python pour zap api scan.
===========================================================================================================================================================
"""
from zapv2 import ZAPv2
import sys, time, os

if len(sys.argv)!=2: print("Usage: zap_api_scan.py <target>"); sys.exit(1)
target=sys.argv[1]; zap=ZAPv2()

zap.urlopen(target)
zap.spider.scan(target)
while int(zap.spider.status())<100: time.sleep(1)
zap.ascan.scan(target)
while int(zap.ascan.status())<100: time.sleep(1)

out_dir=f"reports/zap_api/{target.replace('://','_')}"
os.makedirs(out_dir, exist_ok=True)
with open(f"{out_dir}/report.html","w") as f: f.write(zap.core.htmlreport())
